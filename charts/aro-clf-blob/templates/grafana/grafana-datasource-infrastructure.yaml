# https://github.com/grafana/loki/blob/main/operator/hack/addon_grafana_gateway_ocp_oauth.yaml
{{ if .Values.clf.infrastructure }}
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: {{ include "aro-clf-blob.fullname" . }}-infrastructure
  labels:
    {{- include "aro-clf-blob.labels" . | nindent 4 }}
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  datasource:
    name: Loki (Infrastructure)
    type: loki
    editable: true
    access: proxy
    url: https://logging-loki-gateway-http.openshift-logging.svc.cluster.local:8080/api/logs/v1/infrastructure/
    jsonData:
      httpHeaderName1: X-Scope-OrgID
      httpHeaderName2: Authorization
      oauthPassThru: true
      # tlsAuthWithCACert: true
      tlsSkipVerify: true
    secureJsonData:
      httpHeaderValue1: infrastructure
      httpHeaderValue2: "Bearer {{ .Values.bearertoken }}"
  {{ end }}
